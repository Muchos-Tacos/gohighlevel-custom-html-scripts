<script>
	/*
    Zip Code Validation Script for Go High Level surveys. Relies on GHL conditional logic.
    Steps:
    Add a slide for ZIP code input (data-q="postal_code")
    Add a radio button field (data-q="ZIP_VALID") with options "YES" and "NO" (HIDDEN)
    Add a radio button field (data-q="PICKUP_ZONE") with options "ZONE_1", "ZONE_2", "ZONE_3" (HIDDEN)
    Paste this script into slide's custom HTML field.
    Add a closing slide with: Thanks Message, Disqualification Message
    Add a date-selector slide with 3 calendar items corresponding to each zone (HIDDEN).
    Add conditional logic:
    - Hide Thanks Message IF ZIP_VALID IS EQUAL TO NO
    - Hide Disqualification Message IF ZIP_VALID IS EQUAL TO YES
    - Jump to Slide: IF ZIP_VALID IS EQUAL TO YES JUMP TO [NEXT SLIDE]
    - Jump to Slide: IF ZIP_VALID IS EQUAL TO NO JUMP TO [CLOSING SLIDE]
    - Show Zone # calendar IF PICKUP_ZONE IS EQUAL TO ZONE_# (3 items)
    - Disqualify Lead IF ZIP_VALID IS EQUAL TO NO OPEN URL [HOME] ON SUBMIT
    Replace zone lists to repurpose.
    */
	const zone1 = new Set([
		'32701',
		'32703',
		'32707',
		'32712',
		'32714',
		'32730',
		'32746',
		'32750',
		'32751',
		'32779',
		'32789',
		'32792',
		'32798',
		'32801',
		'32803',
		'32804',
		'32807',
		'32808',
		'32810',
		'32814',
		'32818',
		'32822',
		'33401',
		'33403',
		'33404',
		'33405',
		'33406',
		'33407',
		'33408',
		'33409',
		'33410',
		'33411',
		'33412',
		'33413',
		'33414',
		'33415',
		'33417',
		'33418',
		'33426',
		'33427',
		'33428',
		'33429',
		'33430',
		'33431',
		'33432',
		'33433',
		'33434',
		'33435',
		'33436',
		'33437',
		'33438',
		'33444',
		'33445',
		'33446',
		'33449',
		'33458',
		'33460',
		'33461',
		'33462',
		'33463',
		'33464',
		'33467',
		'33469',
		'33470',
		'33472',
		'33473',
		'33476',
		'33477',
		'33478',
		'33480',
		'33481',
		'33483',
		'33484',
		'33486',
		'33487',
		'33488',
		'33493',
		'33496',
		'33497',
		'33498',
		'33499',
		'34705',
		'34712',
		'34715',
		'34734',
		'34756',
		'34760',
		'34761',
	]);

	const zone2 = new Set([
		'32708',
		'32709',
		'32732',
		'32754',
		'32765',
		'32766',
		'32773',
		'32817',
		'32820',
		'32825',
		'32826',
		'32827',
		'32828',
		'32829',
		'32831',
		'32832',
		'32833',
		'34769',
		'34771',
		'34772',
		'34773',
	]);

	const zone3 = new Set([
		'32805',
		'32806',
		'32809',
		'32811',
		'32812',
		'32819',
		'32821',
		'32824',
		'32830',
		'32835',
		'32836',
		'32837',
		'32839',
		'34741',
		'34743',
		'34747',
		'34786',
		'34787',
	]);

	const validZips = new Set([...zone1, ...zone2, ...zone3]);

	// Watch for ZIP field changes
	const zipField = document.querySelector('input[data-q="postal_code"]');
	// console.log('[ZIP Validation] Script initialized');
	// console.log('[ZIP Validation] Valid zips loaded:', validZips.size);
	// console.log('[ZIP Validation] Zip field found:', !!zipField);

	// if (!zipField) {
	// 	console.warn(
	// 		'[ZIP Validation] Zip field not found! Selector: input[data-q="postal_code"]'
	// 	);
	// }

	// Determine which zone a zip belongs to
	function getZone(zip) {
		if (zone1.has(zip)) return 'ZONE_1';
		if (zone2.has(zip)) return 'ZONE_2';
		if (zone3.has(zip)) return 'ZONE_3';
		return null;
	}

	zipField?.addEventListener('input', function () {
		const zipValue = this.value.trim();
		const qualified = validZips.has(zipValue) ? 'YES' : 'NO';
		const pickupZone = getZone(zipValue);
		// console.log('[ZIP Validation] Input event fired');
		// console.log('[ZIP Validation] Zip entered:', zipValue);
		// console.log('[ZIP Validation] Is valid:', qualified);
		// console.log('[ZIP Validation] Pickup zone:', pickupZone);

		// Update ZIP_VALID radio
		const radioOption = document.querySelector(
			`input[data-q="ZIP_VALID"][value="${qualified}"]`
		);
		// console.log('[ZIP Validation] ZIP_VALID radio found:', !!radioOption);

		if (radioOption) {
			radioOption.checked = true;
			radioOption.dispatchEvent(new Event('change', { bubbles: true }));
			// console.log('[ZIP Validation] ZIP_VALID updated to:', qualified);
		} // else {
		// 	console.warn(
		// 		'[ZIP Validation] ZIP_VALID radio not found! Selector:',
		// 		`input[data-q="ZIP_VALID"][value="${qualified}"]`
		// 	);
		// }

		// Update PICKUP_ZONE radio
		if (pickupZone) {
			const zoneRadio = document.querySelector(
				`input[data-q="PICKUP_ZONE"][value="${pickupZone}"]`
			);
			// console.log(
			// 	'[ZIP Validation] PICKUP_ZONE radio found:',
			// 	!!zoneRadio
			// );

			if (zoneRadio) {
				zoneRadio.checked = true;
				zoneRadio.dispatchEvent(new Event('change', { bubbles: true }));
				// console.log(
				// 	'[ZIP Validation] PICKUP_ZONE updated to:',
				// 	pickupZone
				// );
			} // else {
			// 	console.warn(
			// 		'[ZIP Validation] PICKUP_ZONE radio not found! Selector:',
			// 		`input[data-q="PICKUP_ZONE"][value="${pickupZone}"]`
			// 	);
			// }
		}
	});
</script>
